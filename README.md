# Waviot UTP (Update Transfer Protocol)
## 1. Краткое работы библиотеки
#### 1.1 Процесс запроса свободной памяти
Для записи данных пользователю необходимо выполнить запрос на выделение сектора памяти указанного размера. Если в памяти есть область запрошенного размера, то библиотека возвращает пользователю структуру с описанием этой области: начальный адрес, размер. 
#### 1.2 Процесс записи
После успешного выделения памяти, начинается последовательная запись данных в отведенный сектор. После чего пользователь выплняет фиксацию данных: полезные данные записываются в начало памяти, структура с описанием этих данных располагаетя в конце памяти (подобно стэку).
#### 1.3 Удаление данных
Когда пользователь делает запрос на удаление участка памяти по уникальному номеру, то библиотека находит структуру в конце памяти, которая описывает привязанные к ней полезные данные. По этому описанию библиотека получает начальный адрес удаляемого участка памяти и его размер. Затем присходит очистка и "уплотнение" оставшихся данные в памяти. Иллюстрация процесса удаления представлена ниже. Каждый номер - данные, с соответствующим уникальным номером. 
```
1111111111-AAAAAAAAA-22222
1111111111-000000000-22222
1111111111-222220000-00000
```
## 2. Инициализация UTP Обработчика
```c
#include "WVT_UTP.h"
int main(void){
    WVT_UTP_Init_t settings;
    settings.memory_size        = 1024 * 4; 
    settings.memory_page_size   = 8;      
    settings.init               = &memory_init;
    settings.memory_erase       = &memory_erase;
    settings.memory_read        = &memory_read;
    settings.memory_write       = &memory_write;
    WVT_UTP_init(settings);
}
```

WVT_UTP_Init_t содержит в себе параметры выделенной памяти, а также HAL-коллбэки
| Параметр | Описание |
| ------ | ----------- |
| memory_size   | Полный размер памяти, отведенной для хранилища данных |
| memory_page_size | Размер страницы флеш-памяти |
## Описание коллбэков

| Коллбэк | Описание |
| ------ | ----------- |
| init   | Вызывается перед началом работы библитеки, в качестве аргумента передается полный размер памяти memory_size|
| memory_erase | Стереть участок памяти. Библиотека гарантирует, что относительный адрес начала стирания будет равен началу страницы флеш памяти, а запрашиваемый размер области очистки будет кратен размеру страницы  |
| memory_read    | Прочитать участок памяти указанного размера по относительному адресу |
| memory_write   | Стереть участок памяти указанного размера по относительному адресу |
